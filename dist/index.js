/* eslint-disable */
function t(t){var e=new Error(t);throw e.name="CronError",e}function e(t,e,n){return t*(n-e)+e|0}Object.defineProperty(exports,"__esModule",{value:!0});var n={__proto__:null,Sun:0,Mon:1,Tue:2,Wed:3,Thu:4,Fri:5,Sat:6},r={calendar:"gregory",numberingSystem:"latn",timeZone:void 0,hourCycle:"h23",hour12:!1,weekday:"short",era:"short",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",timeZoneName:void 0,fractionalSecondDigits:void 0},i={};var o="Incorrect ParsedDate ";function s(e,n){var r=+e;return r!==r>>>0&&t(`${o}${n}: "${e}"`),r}function a(e){var r=e._date,a=i[e._zone].f.format(r).split(/[,\s:]+/);e.W=a[0]in n?n[a[0]]:t(`${o}W: "${a[0]}"`),e.M=s(a[1],"M"),e.D=s(a[2],"D"),e.Y=s(a[3],"Y"),e.E="AD"===a[4]||"BC"===a[4]?a[4]:t(`${o}E: "${a[4]}"`),e.h=s(a[5],"h"),e.m=s(a[6],"m"),e.s=s(a[7],"s"),e.t=r.getMilliseconds(),e.z=Date.UTC(e.Y,e.M-1,e.D,e.h,e.m,e.s,e.t)-r.getTime()}function u(t){var e=t.z;a(t),e!==t.z&&(t._date.setMilliseconds(e-t.z),a(t))}class ParsedDate{constructor(t,e){this._date=t?new Date(t.getTime()):new Date,this._zone=function(t){if(!i[t]){r.timeZone=t,r.timeZoneName=void 0,r.fractionalSecondDigits=void 0;var e=new Intl.DateTimeFormat("en-US",r),n=e.resolvedOptions().timeZone;i[t]=i[n]={f:e,z:n}}return i[t].z}(e),a(this)}toString(t){return r.timeZone=this._zone,r.timeZoneName="short",r.fractionalSecondDigits=3,this._date.toLocaleString(t,r)}clone(){return new ParsedDate(this._date,this._zone)}year(t){if(void 0!==t&&t!==this.Y){var e=this._date;e.setFullYear(e.getFullYear()-this.Y+t),u(this)}return this.Y}month(t){if(void 0!==t&&t!==this.M){var e=this._date;e.setMonth(e.getMonth()-this.M+t),u(this)}return this.M}date(t){if(void 0!==t&&t!==this.D){var e=this._date;e.setDate(e.getDate()-this.D+t),u(this)}return this.D}hours(t){if(void 0!==t&&t!==this.h){var e=this._date;e.setHours(e.getHours()-this.h+t),u(this)}return this.h}minutes(t){if(void 0!==t&&t!==this.m){var e=this._date;e.setMinutes(e.getMinutes()-this.m+t),u(this)}return this.m}seconds(t){if(void 0!==t&&t!==this.s){var e=this._date;e.setSeconds(e.getSeconds()-this.s+t),u(this)}return this.s}milliseconds(t){return void 0!==t&&t!==this.t&&(this._date.setMilliseconds(t),u(this)),this.t}}
/*@__NO_SIDE_EFFECTS__*/function h(t,e){return new ParsedDate(t,e)}var d=0;function f(){++d>9e3&&t(`Max iterates count: ${d}`)}function c(t,n,r,i){var o=[],s=h(n,r);if(s.milliseconds(1e3),d=0,l(t,s,o),i&&o.some(function(t){return t.rand})){var a=s.clone();a.milliseconds(1e3),l(t,a,[]),function(t,n,r,i){var o,s;if(o=r[4].rand)for(s=!1,o=e(i(),0,o);o-- >0;){if(t.Y===n.Y&&t.M===n.M){s&&t.month(t.M-1);break}s=!0,t.month(t.M+1)}if(r[5].rand||r[3].rand)for(s=!1,o=e(i(),0,Math.min(r[5].rand||r[3].rand,r[3].rand||r[5].rand));o-- >0;){if(t.Y===n.Y&&t.M===n.M&&t.D===n.D){s&&t.date(t.D-1);break}s=!0,t.date(t.D+1)}if(o=r[2].rand)for(s=!1,o=e(i(),0,o);o-- >0;){if(t.Y===n.Y&&t.M===n.M&&t.D===n.D&&t.h===n.h){s&&t.hours(t.h-1);break}s=!0,t.hours(t.h+1)}if(o=r[1].rand)for(s=!1,o=e(i(),0,o);o-- >0;){if(t.Y===n.Y&&t.M===n.M&&t.D===n.D&&t.h===n.h&&t.m===n.m){s&&t.minutes(t.m-1);break}s=!0,t.minutes(t.m+1)}if(o=r[0].rand)for(s=!1,o=e(i(),0,o);o-- >0;){if(t.Y===n.Y&&t.M===n.M&&t.D===n.D&&t.h===n.h&&t.m===n.m&&t.s===n.s){s&&t.seconds(t.s-1);break}s=!0,t.seconds(t.s+1)}}(s,a,o,i)}return s._date}function l(t,e,n){var r=t[4].data;if(!(e.M in r))for(e.seconds(0),e.minutes(0),e.hours(0),e.date(1);f(),e.month(e.M+1),!(e.M in r););n[4]=r[e.M][0],v(t,e,n)}function m(t,e,n){if(e.D in t)for(var r=t[e.D],i=0;i<r.length;++i){var o=r[i];if(n[3]=o,!o.last&&!o.work)return!0;if(o.last&&o.work){if(e.W>0&&e.W<6)for(var s=e.M,a=e.clone();;){if(a.date(a.D+1),a.M!==s)return!0;if(a.W>0&&a.W<6)break}return!1}if(o.last){var u=e.M,h=e.clone();return h.date(e.D+1),h.M!==u&&(n[3]=o,!0)}if(o.work){var d=e.W;if(d>0&&d<6)return!0}}return!1}function v(t,e,n){var r=t[3].data;if(!m(r,e,n)){e.seconds(0),e.minutes(0),e.hours(0);for(var i=e.M;;){if(f(),e.date(e.D+1),e.M!==i)return l(t,e,n);if(m(r,e,n))break}}!function(t,e,n){var r=t[5].data;if(!function(t,e,n){if(e.W in t)for(var r=t[e.W],i=0;i<r.length;++i){var o=r[i];if(n[5]=o,!o.last&&!o.week)return!0;if(o.last){var s=e.M,a=e.clone();if(a.date(e.D+7),a.M!==s)return!0}if(o.week)for(var u=e.M,h=o.week,d=h.length;d-- >0;){var f=e.clone();if(f.date(e.D-7*(h[d]-1)),f.M===u&&(f.date(e.D-7*h[d]),f.M!==u))return!0}}return!1}(r,e,n)){e.seconds(0),e.minutes(0),e.hours(0),f();var i=e.M;return e.date(e.D+1),i===e.M?v(t,e,n):l(t,e,n)}D(t,e,n)}(t,e,n)}function D(t,e,n){var r=t[2].data;if(!(e.h in r)){e.seconds(0),e.minutes(0);for(var i=e.D;;){if(f(),e.hours(e.h+1),e.D!==i)return v(t,e,n);if(e.h in r)break}}n[2]=r[e.h][0],M(t,e,n)}function M(t,e,n){var r=t[1].data;if(!(e.m in r)){e.seconds(0);for(var i=e.h;;){if(f(),e.minutes(e.m+1),e.h!==i)return D(t,e,n);if(e.m in r)break}}n[1]=r[e.m][0],function(t,e,n){var r=t[0].data;if(!(e.s in r))for(var i=e.m;;){if(f(),e.seconds(e.s+1),e.m!==i)return M(t,e,n);if(e.s in r)break}n[0]=r[e.s][0]}(t,e,n)}var _=["seconds","minutes","hours","daysOfMonth","months","daysOfWeek"];function p(t){return t?t.replace(/\s+/g,"").split(","):["*"]}
/*@__NO_SIDE_EFFECTS__*/function g(t){return function(e){return e&&(e=e.replace(/@?([a-z]{3,})/gi,function(e,n){var r=n.toUpperCase();return r in t?t[r]:n})),e}}var S={__proto__:null,YEARLY:"0 0 0 1 1 *",MONTHLY:"0 0 0 1 * *",WEEKLY:"0 0 0 * * 0",DAILY:"0 0 0 * * *",HOURLY:"0 0 * * * *",MINUTELY:"0 * * * * *",SECONDLY:"* * * * * *",WEEKDAYS:"0 0 0 * * 1-5",WEEKENDS:"0 0 0 * * 0,6"},T=g(S),w=g({__proto__:null,JAN:"1",FEB:"2",MAR:"3",APR:"4",MAY:"5",JUN:"6",JUL:"7",AUG:"8",SEP:"9",OCT:"10",NOV:"11",DEC:"12"}),Y=g({__proto__:null,SUN:"0",MON:"1",TUE:"2",WED:"3",THU:"4",FRI:"5",SAT:"6"});function $(t,e){for(var n,r=0;r<t.length;r++)for(var i,o=t[r],s=o.step,a=o.rules,u=o.limit,h=u[0],d=u[1],f=o.range,c=f[0],l=f[1],m=c;m<=l;m+=s)(m<=d&&(i=m,1)||m-d===1&&(i=h,1))&&(n||(n=Object.create(null)),i in n?n[i].push(a):n[i]=[a]);return{type:_[e],data:n,opts:t}}function k(e,n,r,i){var o=+e;return o!=o&&t(`Not a number "${e}" in "${n}"`),o!==o>>>0&&t(`Invalid number "${e}" in "${n}"`),(o<r||o>i)&&t(`The number "${e}" is out of range "[${r}, ${i}]" in "${n}"`),o}function E(e,n,r,i,o){var s=n.split("/");s.length>2&&t(`Too many slashes in "${n}"`);var a,u,h,d,f,c,l,m=s[0],v=s[1];if(m.indexOf("#")>-1)if(5===e){var D=m.split("#");m=D[0],d=[];for(var M=D.length;M-- >1;)d[M-1]=k(D[M],n,1,5)}else t(`Symbol "#" not work in "${n}"`);if(m.indexOf("W")>-1&&(3===e&&"LW"===m?(f=!0,m=m.slice(0,-1)):t(`Symbol "W" not work in "${n}"`)),"L"===m[m.length-1]&&(5===e?(u=!0,m=m.replace(/L/g,"")||"0"):3===e&&"L"===m?(u=!0,m=f?"26-31":"28-31"):t(`Symbol "L" not work in "${n}"`)),"*"===m||"?"===m)c=r,l=o;else{var _=m.split(/(?<=[*?\d])-(?=[*?\d.%-])/);_.length>2&&t(`Too many dashes in "${n}"`),(c=k(_[0],n,r,o))>(l=_[1]?k(_[1],n,r,o):v?i:c)&&t(`Incorrect range "[${c}, ${l}]" in "${n}"`)}v?(u&&3===e&&t(`Options "L" and "/${v}" are incompatible in "${n}"`),"%"===v[0]&&(h=1,v=v.slice(1)),a=k(v,n,1,o),h&&(h=a),h&&a<2&&t(`Random "%1" won't work in "${n}". Set "%2" or more`)):a=1;var p={};return u&&(p.last=u),h&&(p.rand=h),d&&(p.week=d),f&&(p.work=f),{text:n,step:a,rules:p,limit:[r,i],range:[c,l]}}function b(t){return E(0,t,0,59,60)}function x(t){return E(1,t,0,59,60)}function W(t){return E(2,t,0,23,24)}function y(t){return E(3,t,1,31,31)}function C(t){return E(4,t,1,12,12)}function L(t){return E(5,t,0,6,7)}
/*@__NO_SIDE_EFFECTS__*/function N(e){var n=T(e).split(/(?<=[*?\w])\s+(?=[*?\w.%])|(?<=[*?\w])(?=[*?])|(?<=[*?])(?=[*?\w.%])/);return n.length>6&&t(`Too many fields in ["${n.join('" "')}"]`),n.length<6&&n.unshift("0"),[$(p(n[0]).map(b),0),$(p(n[1]).map(x),1),$(p(n[2]).map(W),2),$(p(n[3]).map(y),3),$(p(w(n[4])).map(C),4),$(p(Y(n[5])).map(L),5)]}function O(t,e){var n=e.getTime()-Date.now();t._timeoutId=n>214e7?setTimeout(function(){O(t,e)},21e8):setTimeout(function(){I(t),t.onTick.call(t)},n>=1?n:1)}function I(t){O(t,t.nextDate=c(t._cronTimeParsed,void 0,t._timeZone,t._randomFunction))}class CronScheduler{constructor(t){this._timeZone=t.timeZone,this._cronTimeParsed=N(this._cronTime=t.cronTime),this.nextDate=this._timeoutId=null,this.started=!1;var e,n=t.seedForRandom;this._randomFunction=n?((e=n)&&isFinite(e)||(e=1),function(){var t;
/*@__NO_SIDE_EFFECTS__*/return t=e,t^=t<<13,(2147483648+(e=(t^=t>>17)^t<<5))/4294967296}):Math.random,this.onTick=t.onTick,this.onStart=t.onStart,this.onStop=t.onStop,(t.start||void 0===t.start)&&this.start()}start(){this.started||(this.started=!0,I(this),this.onStart&&this.onStart.call(this))}stop(){this.started&&(this.started=!1,this.nextDate=null,null!=this._timeoutId&&(clearTimeout(this._timeoutId),this._timeoutId=null),this.onStop&&this.onStop.call(this))}}function P(t){return new CronScheduler(t)}exports.CRON_TIME_PRESETS=S,exports.CronScheduler=CronScheduler,exports.ParsedDate=ParsedDate,exports.default=P,exports.findNextExecDate=c,exports.newCronScheduler=P,exports.parseCronTime=N,exports.parseDate=h;
