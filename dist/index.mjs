/* eslint-disable */
function t(t){var n=new Error(t);throw n.name="CronError",n}function n(t,n,e){return t*(e-n)+n|0}var e={__proto__:null,Sun:0,Mon:1,Tue:2,Wed:3,Thu:4,Fri:5,Sat:6},i={calendar:"gregory",numberingSystem:"latn",timeZone:void 0,hourCycle:"h23",hour12:!1,weekday:"short",era:"short",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",timeZoneName:void 0,fractionalSecondDigits:void 0},r={};var o="Incorrect ParsedDate ";function a(n,e){var i=+n;return i!==i>>>0&&t(`${o}${e}: "${n}"`),i}function s(n){var i=n._date,s=r[n._zone].f.format(i).split(/[,\s:]+/);n.W=s[0]in e?e[s[0]]:t(`${o}W: "${s[0]}"`),n.M=a(s[1],"M"),n.D=a(s[2],"D"),n.Y=a(s[3],"Y"),n.E="AD"===s[4]||"BC"===s[4]?s[4]:t(`${o}E: "${s[4]}"`),n.h=a(s[5],"h"),n.m=a(s[6],"m"),n.s=a(s[7],"s"),n.t=i.getMilliseconds(),n.z=Date.UTC(n.Y,n.M-1,n.D,n.h,n.m,n.s,n.t)-i.getTime()}function u(t){var n=t.z;s(t),n!==t.z&&(t._date.setMilliseconds(n-t.z),s(t))}class ParsedDate{constructor(t,n){this._date=t?new Date(t.getTime()):new Date,this._zone=function(t){if(!r[t]){i.timeZone=t,i.timeZoneName=void 0,i.fractionalSecondDigits=void 0;var n=new Intl.DateTimeFormat("en-US",i),e=n.resolvedOptions().timeZone;r[t]=r[e]={f:n,z:e}}return r[t].z}(n),s(this)}toString(t){return i.timeZone=this._zone,i.timeZoneName="short",i.fractionalSecondDigits=3,this._date.toLocaleString(t,i)}clone(){return new ParsedDate(this._date,this._zone)}year(t){if(void 0!==t&&t!==this.Y){var n=this._date;n.setFullYear(n.getFullYear()-this.Y+t),u(this)}return this.Y}month(t){if(void 0!==t&&t!==this.M){var n=this._date;n.setMonth(n.getMonth()-this.M+t),u(this)}return this.M}date(t){if(void 0!==t&&t!==this.D){var n=this._date;n.setDate(n.getDate()-this.D+t),u(this)}return this.D}hours(t){if(void 0!==t&&t!==this.h){var n=this._date;n.setHours(n.getHours()-this.h+t),u(this)}return this.h}minutes(t){if(void 0!==t&&t!==this.m){var n=this._date;n.setMinutes(n.getMinutes()-this.m+t),u(this)}return this.m}seconds(t){if(void 0!==t&&t!==this.s){var n=this._date;n.setSeconds(n.getSeconds()-this.s+t),u(this)}return this.s}milliseconds(t){return void 0!==t&&t!==this.t&&(this._date.setMilliseconds(t),u(this)),this.t}}
/*@__NO_SIDE_EFFECTS__*/function h(t,n){return new ParsedDate(t,n)}var d=0;function f(){++d>9e3&&t(`Max iterates count: ${d}`)}function c(t,e,i,r){var o=[],a=h(e,i);if(a.milliseconds(1e3),d=0,l(t,a,o),r&&o.some(function(t){return t.rand})){var s=a.clone();s.milliseconds(1e3),l(t,s,[]),function(t,e,i,r){var o,a;if(o=i[4].rand)for(a=!1,o=n(r(),0,o);o-- >0;){if(t.Y===e.Y&&t.M===e.M){a&&t.month(t.M-1);break}a=!0,t.month(t.M+1)}if(i[5].rand||i[3].rand)for(a=!1,o=n(r(),0,Math.min(i[5].rand||i[3].rand,i[3].rand||i[5].rand));o-- >0;){if(t.Y===e.Y&&t.M===e.M&&t.D===e.D){a&&t.date(t.D-1);break}a=!0,t.date(t.D+1)}if(o=i[2].rand)for(a=!1,o=n(r(),0,o);o-- >0;){if(t.Y===e.Y&&t.M===e.M&&t.D===e.D&&t.h===e.h){a&&t.hours(t.h-1);break}a=!0,t.hours(t.h+1)}if(o=i[1].rand)for(a=!1,o=n(r(),0,o);o-- >0;){if(t.Y===e.Y&&t.M===e.M&&t.D===e.D&&t.h===e.h&&t.m===e.m){a&&t.minutes(t.m-1);break}a=!0,t.minutes(t.m+1)}if(o=i[0].rand)for(a=!1,o=n(r(),0,o);o-- >0;){if(t.Y===e.Y&&t.M===e.M&&t.D===e.D&&t.h===e.h&&t.m===e.m&&t.s===e.s){a&&t.seconds(t.s-1);break}a=!0,t.seconds(t.s+1)}}(a,s,o,r)}return a._date}function l(t,n,e){var i=t[4].data;if(!(n.M in i))for(n.seconds(0),n.minutes(0),n.hours(0),n.date(1);f(),n.month(n.M+1),!(n.M in i););e[4]=i[n.M][0],v(t,n,e)}function m(t,n,e){if(n.D in t)for(var i=t[n.D],r=0;r<i.length;++r){var o=i[r];if(e[3]=o,!o.last&&!o.work)return!0;if(o.last&&o.work){if(n.W>0&&n.W<6)for(var a=n.M,s=n.clone();;){if(s.date(s.D+1),s.M!==a)return!0;if(s.W>0&&s.W<6)break}return!1}if(o.last){var u=n.M,h=n.clone();return h.date(n.D+1),h.M!==u&&(e[3]=o,!0)}if(o.work){var d=n.W;if(d>0&&d<6)return!0}}return!1}function v(t,n,e){var i=t[3].data;if(!m(i,n,e)){n.seconds(0),n.minutes(0),n.hours(0);for(var r=n.M;;){if(f(),n.date(n.D+1),n.M!==r)return l(t,n,e);if(m(i,n,e))break}}!function(t,n,e){var i=t[5].data;if(!function(t,n,e){if(n.W in t)for(var i=t[n.W],r=0;r<i.length;++r){var o=i[r];if(e[5]=o,!o.last&&!o.week)return!0;if(o.last){var a=n.M,s=n.clone();if(s.date(n.D+7),s.M!==a)return!0}if(o.week)for(var u=n.M,h=o.week,d=h.length;d-- >0;){var f=n.clone();if(f.date(n.D-7*(h[d]-1)),f.M===u&&(f.date(n.D-7*h[d]),f.M!==u))return!0}}return!1}(i,n,e)){n.seconds(0),n.minutes(0),n.hours(0),f();var r=n.M;return n.date(n.D+1),r===n.M?v(t,n,e):l(t,n,e)}D(t,n,e)}(t,n,e)}function D(t,n,e){var i=t[2].data;if(!(n.h in i)){n.seconds(0),n.minutes(0);for(var r=n.D;;){if(f(),n.hours(n.h+1),n.D!==r)return v(t,n,e);if(n.h in i)break}}e[2]=i[n.h][0],M(t,n,e)}function M(t,n,e){var i=t[1].data;if(!(n.m in i)){n.seconds(0);for(var r=n.h;;){if(f(),n.minutes(n.m+1),n.h!==r)return D(t,n,e);if(n.m in i)break}}e[1]=i[n.m][0],function(t,n,e){var i=t[0].data;if(!(n.s in i))for(var r=n.m;;){if(f(),n.seconds(n.s+1),n.m!==r)return M(t,n,e);if(n.s in i)break}e[0]=i[n.s][0]}(t,n,e)}var _=["seconds","minutes","hours","daysOfMonth","months","daysOfWeek"];function g(t){return t?t.replace(/\s+/g,"").split(","):["*"]}
/*@__NO_SIDE_EFFECTS__*/function p(t){return function(n){return n&&(n=n.replace(/@?([a-z]{3,})/gi,function(n,e){var i=e.toUpperCase();return i in t?t[i]:e})),n}}var S={__proto__:null,YEARLY:"0 0 0 1 1 *",MONTHLY:"0 0 0 1 * *",WEEKLY:"0 0 0 * * 0",DAILY:"0 0 0 * * *",HOURLY:"0 0 * * * *",MINUTELY:"0 * * * * *",SECONDLY:"* * * * * *",WEEKDAYS:"0 0 0 * * 1-5",WEEKENDS:"0 0 0 * * 0,6"},Y=p(S),$=p({__proto__:null,JAN:"1",FEB:"2",MAR:"3",APR:"4",MAY:"5",JUN:"6",JUL:"7",AUG:"8",SEP:"9",OCT:"10",NOV:"11",DEC:"12"}),k=p({__proto__:null,SUN:"0",MON:"1",TUE:"2",WED:"3",THU:"4",FRI:"5",SAT:"6"});function w(t,n){for(var e,i=0;i<t.length;i++)for(var r,o=t[i],a=o.step,s=o.rules,u=o.limit,h=u[0],d=u[1],f=o.range,c=f[0],l=f[1],m=c;m<=l;m+=a)(m<=d&&(r=m,1)||m-d===1&&(r=h,1))&&(e||(e=Object.create(null)),r in e?e[r].push(s):e[r]=[s]);return{type:_[n],data:e,opts:t}}function T(n,e,i,r){var o=+n;return o!=o&&t(`Not a number "${n}" in "${e}"`),o!==o>>>0&&t(`Invalid number "${n}" in "${e}"`),(o<i||o>r)&&t(`The number "${n}" is out of range "[${i}, ${r}]" in "${e}"`),o}function b(n,e,i,r,o){var a=e.split("/");a.length>2&&t(`Too many slashes in "${e}"`);var s,u,h,d,f,c,l,m=a[0],v=a[1];if(m.indexOf("#")>-1)if(5===n){var D=m.split("#");m=D[0],d=[];for(var M=D.length;M-- >1;)d[M-1]=T(D[M],e,1,5)}else t(`Symbol "#" not work in "${e}"`);if(m.indexOf("W")>-1&&(3===n&&"LW"===m?(f=!0,m=m.slice(0,-1)):t(`Symbol "W" not work in "${e}"`)),"L"===m[m.length-1]&&(5===n?(u=!0,m=m.replace(/L/g,"")||"0"):3===n&&"L"===m?(u=!0,m=f?"26-31":"28-31"):t(`Symbol "L" not work in "${e}"`)),"*"===m||"?"===m)c=i,l=o;else{var _=m.split(/(?<=[*?\d])-(?=[*?\d.%-])/);_.length>2&&t(`Too many dashes in "${e}"`),(c=T(_[0],e,i,o))>(l=_[1]?T(_[1],e,i,o):v?r:c)&&t(`Incorrect range "[${c}, ${l}]" in "${e}"`)}v?(u&&3===n&&t(`Options "L" and "/${v}" are incompatible in "${e}"`),"%"===v[0]&&(h=1,v=v.slice(1)),s=T(v,e,1,o),h&&(h=s),h&&s<2&&t(`Random "%1" won't work in "${e}". Set "%2" or more`)):s=1;var g={};return u&&(g.last=u),h&&(g.rand=h),d&&(g.week=d),f&&(g.work=f),{text:e,step:s,rules:g,limit:[i,r],range:[c,l]}}function E(t){return b(0,t,0,59,60)}function W(t){return b(1,t,0,59,60)}function y(t){return b(2,t,0,23,24)}function L(t){return b(3,t,1,31,31)}function N(t){return b(4,t,1,12,12)}function O(t){return b(5,t,0,6,7)}
/*@__NO_SIDE_EFFECTS__*/function I(n){var e=Y(n).split(/(?<=[*?\w])\s+(?=[*?\w.%])|(?<=[*?\w])(?=[*?])|(?<=[*?])(?=[*?\w.%])/);return e.length>6&&t(`Too many fields in ["${e.join('" "')}"]`),e.length<6&&e.unshift("0"),[w(g(e[0]).map(E),0),w(g(e[1]).map(W),1),w(g(e[2]).map(y),2),w(g(e[3]).map(L),3),w(g($(e[4])).map(N),4),w(g(k(e[5])).map(O),5)]}function z(t,n){var e=n.getTime()-Date.now();t._timeoutId=e>214e7?setTimeout(function(){z(t,n)},21e8):setTimeout(function(){C(t),t.onTick.call(t)},e>=1?e:1)}function C(t){z(t,t.nextDate=c(t._cronTimeParsed,void 0,t._timeZone,t._randomFunction))}class CronScheduler{constructor(t){this._timeZone=t.timeZone,this._cronTimeParsed=I(this._cronTime=t.cronTime),this.nextDate=this._timeoutId=null,this.started=!1;var n,e=t.seedForRandom;this._randomFunction=e?((n=e)&&isFinite(n)||(n=1),function(){var t;
/*@__NO_SIDE_EFFECTS__*/return t=n,t^=t<<13,(2147483648+(n=(t^=t>>17)^t<<5))/4294967296}):Math.random,this.onTick=t.onTick,this.onStart=t.onStart,this.onStop=t.onStop,(t.start||void 0===t.start)&&this.start()}start(){this.started||(this.started=!0,C(this),this.onStart&&this.onStart.call(this))}stop(){this.started&&(this.started=!1,this.nextDate=null,null!=this._timeoutId&&(clearTimeout(this._timeoutId),this._timeoutId=null),this.onStop&&this.onStop.call(this))}}function U(t){return new CronScheduler(t)}export{S as CRON_TIME_PRESETS,CronScheduler,ParsedDate,U as default,c as findNextExecDate,U as newCronScheduler,I as parseCronTime,h as parseDate};
