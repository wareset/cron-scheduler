/* eslint-disable */
function t(t){var e=new Error(t);throw e.name="CronScheduler",e}function e(t,e,n){return t*(n-e+1)+e|0}var n=["seconds","minutes","hours","daysOfMonth","months","daysOfWeek"];function i(t){return t?t.replace(/\s+/g,"").split(","):["*"]}
/*@__NO_SIDE_EFFECTS__*/function r(t){return function(e){return e&&(e=e.replace(/@?([a-z]{1,})/gi,function(e,n){return(n=n.toUpperCase())in t?t[n]:n})),e}}var o={__proto__:null,YEARLY:"0 0 0 1 1 *",MONTHLY:"0 0 0 1 * *",WEEKLY:"0 0 0 * * 0",DAILY:"0 0 0 * * *",HOURLY:"0 0 * * * *",MINUTELY:"0 * * * * *",SECONDLY:"* * * * * *",WEEKDAYS:"0 0 0 * * 1-5",WEEKENDS:"0 0 0 * * 0,6"},a=r(o),s=r({__proto__:null,JAN:"1",FEB:"2",MAR:"3",APR:"4",MAY:"5",JUN:"6",JUL:"7",AUG:"8",SEP:"9",OCT:"10",NOV:"11",DEC:"12"}),u=r({__proto__:null,SUN:"0",MON:"1",TUE:"2",WED:"3",THU:"4",FRI:"5",SAT:"6"});function h(t,e){for(var i,r=0;r<t.length;r++)for(var o,a=t[r],s=a.step,u=a.rules,h=a.limit,d=h[0],f=h[1],c=a.range,l=c[0],m=c[1],v=l;v<=m;v+=s)(v<=f&&(o=v,1)||v-f===1&&(o=d,1))&&(i||(i=Object.create(null)),o in i?i[o].push(u):i[o]=[u]);return{type:n[e],data:i,opts:t}}function d(e,n,i,r){var o=+e;return o!=o&&t(`Not a number "${e}" in "${n}"`),o!==o>>>0&&t(`Invalid number "${e}" in "${n}"`),(o<i||o>r)&&t(`The number "${e}" is out of range "[${i}, ${r}]" in "${n}"`),o}function f(e,n,i,r,o){var a=n.split("/");a.length>2&&t(`Too many slashes in "${n}"`);var s,u,h,f,c,l,m,v=a[0],D=a[1];if(v.indexOf("W")>-1&&(3===e&&"LW"===v?(c=!0,v=v.slice(0,-1)):t(`Symbol "W" not work in "${n}"`)),v.indexOf("L")>-1&&(5===e?(u=!0,v=v.replace(/L/g,"")||"0"):3===e&&"L"===v?(u=!0,v=c?"26-31":"28-31"):t(`Symbol "L" not work in "${n}"`)),v.indexOf("#")>-1)if(5===e){var M=v.split("#");v=M[0],f=[];for(var _=M.length;_-- >1;)f[_-1]=d(M[_],n,1,5)}else t(`Symbol "#" not work in "${n}"`);if("*"===v||"?"===v)l=i,m=o;else{var g=v.split(/(?<=[*?\d])-(?=[*?\d.%-])/);g.length>2&&t(`Too many dashes in "${n}"`),(l=d(g[0],n,i,o))>(m=g[1]?d(g[1],n,i,o):D?r:l)&&t(`Incorrect range "[${l}, ${m}]" in "${n}"`)}D?(u&&3===e&&t(`Options "L" and "/${D}" are incompatible in "${n}"`),"%"===D[0]&&(h=1,D=D.slice(1)),s=d(D,n,1,o),h&&(h=s),h&&s<2&&t(`Random "%1" won't work in "${n}". Set "%2" or more`)):s=1;var p={};return u&&(p.last=u),h&&(p.rand=h),f&&(p.week=f),c&&(p.work=c),{text:n,step:s,rules:p,limit:[i,r],range:[l,m]}}function c(t){return f(0,t,0,59,59)}function l(t){return f(1,t,0,59,59)}function m(t){return f(2,t,0,23,23)}function v(t){return f(3,t,1,31,31)}function D(t){return f(4,t,1,12,12)}function M(t){return f(5,t,0,6,7)}
/*@__NO_SIDE_EFFECTS__*/function _(e){var n=a(e).split(/(?<=[*?\w])\s+(?=[*?\w.%])|(?<=[*?\w])(?=[*?])|(?<=[*?])(?=[*?\w.%])/);return n.length>6&&t(`Too many fields in ["${n.join('" "')}"]`),n.length<6&&n.unshift("0"),[h(i(n[0]).map(c),0),h(i(n[1]).map(l),1),h(i(n[2]).map(m),2),h(i(n[3]).map(v),3),h(i(s(n[4])).map(D),4),h(i(u(n[5])).map(M),5)]}var g={__proto__:null,Sun:0,Mon:1,Tue:2,Wed:3,Thu:4,Fri:5,Sat:6},p={calendar:"gregory",numberingSystem:"latn",timeZone:void 0,hourCycle:"h23",hour12:!1,weekday:"short",era:"short",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",timeZoneName:void 0,fractionalSecondDigits:void 0},S={};var $="Incorrect ParsedDate ";function Y(e,n){var i=+e;return i!==i>>>0&&t(`${$}${n}: "${e}"`),i}function k(e){var n=e._date,i=S[e._zone].f.format(n).split(/[,\s:]+/);e.W=i[0]in g?g[i[0]]:t(`${$}W: "${i[0]}"`),e.M=Y(i[1],"M"),e.D=Y(i[2],"D"),e.Y=Y(i[3],"Y"),e.E="AD"===i[4]||"BC"===i[4]?i[4]:t(`${$}E: "${i[4]}"`),e.h=Y(i[5],"h"),e.m=Y(i[6],"m"),e.s=Y(i[7],"s"),e.t=n.getMilliseconds(),e.z=Date.UTC(e.Y,e.M-1,e.D,e.h,e.m,e.s,e.t)-n.getTime()}function T(t){var e=t.z;k(t),e!==t.z&&(t._date.setMilliseconds(e-t.z),k(t))}class ParsedDate{constructor(t,e){this._date=t?new Date(t.getTime()):new Date,this._zone=function(t){if(!S[t]){p.timeZone=t,p.timeZoneName=void 0,p.fractionalSecondDigits=void 0;var e=new Intl.DateTimeFormat("en-US",p),n=e.resolvedOptions().timeZone;S[t]=S[n]={f:e,z:n}}return S[t].z}(e),k(this)}toString(t){return p.timeZone=this._zone,p.timeZoneName="short",p.fractionalSecondDigits=3,this._date.toLocaleString(t,p)}clone(){return new ParsedDate(this._date,this._zone)}year(t){if(void 0!==t&&t!==this.Y){var e=this._date;e.setFullYear(e.getFullYear()-this.Y+t),T(this)}return this.Y}month(t){if(void 0!==t&&t!==this.M){var e=this._date;e.setMonth(e.getMonth()-this.M+t),T(this)}return this.M}date(t){if(void 0!==t&&t!==this.D){var e=this._date;e.setDate(e.getDate()-this.D+t),T(this)}return this.D}hours(t){if(void 0!==t&&t!==this.h){var e=this._date;e.setHours(e.getHours()-this.h+t),T(this)}return this.h}minutes(t){if(void 0!==t&&t!==this.m){var e=this._date;e.setMinutes(e.getMinutes()-this.m+t),T(this)}return this.m}seconds(t){if(void 0!==t&&t!==this.s){var e=this._date;e.setSeconds(e.getSeconds()-this.s+t),T(this)}return this.s}milliseconds(t){return void 0!==t&&t!==this.t&&(this._date.setMilliseconds(t),T(this)),this.t}}var w=0;function b(e){++w>=1e4&&t(`Max iterates count: ${w}.\nDate: ${e._date}`)}function E(t,n,i,r){var o=[],a=new ParsedDate(n,i);if(a.milliseconds(1e3),w=0,W(t,a,o),r&&o.some(function(t){return t.rand})){var s=a.clone();s.milliseconds(1e3),W(t,s,[]),function(t,n,i,r){var o,a;if(o=i[4].rand)for(a=!1,o=e(r(),0,o);o-- >0;){if(t.Y===n.Y&&t.M===n.M){a&&t.month(t.M-1);break}a=!0,t.month(t.M+1)}if(i[5].rand||i[3].rand)for(a=!1,o=e(r(),0,Math.min(i[5].rand||i[3].rand,i[3].rand||i[5].rand));o-- >0;){if(t.Y===n.Y&&t.M===n.M&&t.D===n.D){a&&t.date(t.D-1);break}a=!0,t.date(t.D+1)}if(o=i[2].rand)for(a=!1,o=e(r(),0,o);o-- >0;){if(t.Y===n.Y&&t.M===n.M&&t.D===n.D&&t.h===n.h){a&&t.hours(t.h-1);break}a=!0,t.hours(t.h+1)}if(o=i[1].rand)for(a=!1,o=e(r(),0,o);o-- >0;){if(t.Y===n.Y&&t.M===n.M&&t.D===n.D&&t.h===n.h&&t.m===n.m){a&&t.minutes(t.m-1);break}a=!0,t.minutes(t.m+1)}if(o=i[0].rand)for(a=!1,o=e(r(),0,o);o-- >0;){if(t.Y===n.Y&&t.M===n.M&&t.D===n.D&&t.h===n.h&&t.m===n.m&&t.s===n.s){a&&t.seconds(t.s-1);break}a=!0,t.seconds(t.s+1)}}(a,s,o,r)}return a._date}function W(t,e,n){var i=t[4].data;if(!(e.M in i))for(e.seconds(0),e.minutes(0),e.hours(0),e.date(1);b(e),e.month(e.M+1),!(e.M in i););n[4]=i[e.M][0],L(t,e,n)}function y(t,e,n){if(e.D in t)for(var i=t[e.D],r=0;r<i.length;++r){var o=i[r];if(n[3]=o,!o.last&&!o.work)return!0;if(o.last&&o.work){if(e.W>0&&e.W<6)for(var a=e.M,s=e.clone();;){if(s.date(s.D+1),s.M!==a)return!0;if(s.W>0&&s.W<6)break}return!1}if(o.last){var u=e.M,h=e.clone();return h.date(e.D+1),h.M!==u&&(n[3]=o,!0)}if(o.work){var d=e.W;if(d>0&&d<6)return!0}}return!1}function L(t,e,n){var i=t[3].data;if(!y(i,e,n)){e.seconds(0),e.minutes(0),e.hours(0);for(var r=e.M;;){if(b(e),e.date(e.D+1),e.M!==r)return W(t,e,n);if(y(i,e,n))break}}!function(t,e,n){var i=t[5].data;if(!function(t,e,n){if(e.W in t)for(var i=t[e.W],r=0;r<i.length;++r){var o=i[r];if(n[5]=o,!o.last&&!o.week)return!0;if(o.last){var a=e.M,s=e.clone();if(s.date(e.D+7),s.M!==a)return!0}if(o.week)for(var u=e.M,h=o.week,d=h.length;d-- >0;){var f=e.clone();if(f.date(e.D-7*(h[d]-1)),f.M===u&&(f.date(e.D-7*h[d]),f.M!==u))return!0}}return!1}(i,e,n)){e.seconds(0),e.minutes(0),e.hours(0),b(e);var r=e.M;return e.date(e.D+1),r===e.M?L(t,e,n):W(t,e,n)}O(t,e,n)}(t,e,n)}function O(t,e,n){var i=t[2].data;if(!(e.h in i)){e.seconds(0),e.minutes(0);for(var r=e.D;;){if(b(e),e.hours(e.h+1),e.D!==r)return L(t,e,n);if(e.h in i)break}}n[2]=i[e.h][0],N(t,e,n)}function N(t,e,n){var i=t[1].data;if(!(e.m in i)){e.seconds(0);for(var r=e.h;;){if(b(e),e.minutes(e.m+1),e.h!==r)return O(t,e,n);if(e.m in i)break}}n[1]=i[e.m][0],function(t,e,n){var i=t[0].data;if(!(e.s in i))for(var r=e.m;;){if(b(e),e.seconds(e.s+1),e.m!==r)return N(t,e,n);if(e.s in i)break}n[0]=i[e.s][0]}(t,e,n)}function I(t,e){var n=e.getTime()-Date.now();t._timeoutId=n>214e7?setTimeout(function(){I(t,e)},21e8):setTimeout(function(){z(t),t.onTick.call(t)},n>=1?n:1)}function z(t){I(t,t.nextDate=E(t._cronTimeParsed,void 0,t._timeZone,t._randomFunction))}class CronScheduler{constructor(t){this._timeZone=t.timeZone,this._cronTimeParsed=_(this._cronTime=t.cronTime),this.nextDate=this._timeoutId=null,this.started=!1;var e,n=t.seedForRandom;this._randomFunction=void 0===n?Math.random:((e=n)&&isFinite(e)||(e=1),function(){var t;return t=e,t^=t<<13,(2147483648+(e=(t^=t>>17)^t<<5))/4294967296}),this.onTick=t.onTick,this.onStart=t.onStart,this.onStop=t.onStop,(t.start||void 0===t.start)&&this.start()}start(){this.started||(this.started=!0,z(this),this.onStart&&this.onStart.call(this))}stop(){this.started&&(this.started=!1,this.nextDate=null,null!=this._timeoutId&&(clearTimeout(this._timeoutId),this._timeoutId=null),this.onStop&&this.onStop.call(this))}}export{o as CRON_TIME_PRESETS,CronScheduler,ParsedDate,E as findNextExecDate,_ as parseCronTime};
