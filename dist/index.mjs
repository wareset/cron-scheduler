/* eslint-disable */
function t(t){var n=new Error(t);throw n.name="CronError",n}function n(t,n,e){return t*(e-n+1)+n|0}var e=["seconds","minutes","hours","daysOfMonth","months","daysOfWeek"];function i(t){return t?t.replace(/\s+/g,"").split(","):["*"]}
/*@__NO_SIDE_EFFECTS__*/function r(t){return function(n){return n&&(n=n.replace(/@?([a-z]{3,})/gi,function(n,e){var i=e.toUpperCase();return i in t?t[i]:e})),n}}var o={__proto__:null,YEARLY:"0 0 0 1 1 *",MONTHLY:"0 0 0 1 * *",WEEKLY:"0 0 0 * * 0",DAILY:"0 0 0 * * *",HOURLY:"0 0 * * * *",MINUTELY:"0 * * * * *",SECONDLY:"* * * * * *",WEEKDAYS:"0 0 0 * * 1-5",WEEKENDS:"0 0 0 * * 0,6"},a=r(o),s=r({__proto__:null,JAN:"1",FEB:"2",MAR:"3",APR:"4",MAY:"5",JUN:"6",JUL:"7",AUG:"8",SEP:"9",OCT:"10",NOV:"11",DEC:"12"}),u=r({__proto__:null,SUN:"0",MON:"1",TUE:"2",WED:"3",THU:"4",FRI:"5",SAT:"6"});function h(t,n){for(var i,r=0;r<t.length;r++)for(var o,a=t[r],s=a.step,u=a.rules,h=a.limit,d=h[0],f=h[1],c=a.range,l=c[0],m=c[1],v=l;v<=m;v+=s)(v<=f&&(o=v,1)||v-f===1&&(o=d,1))&&(i||(i=Object.create(null)),o in i?i[o].push(u):i[o]=[u]);return{type:e[n],data:i,opts:t}}function d(n,e,i,r){var o=+n;return o!=o&&t(`Not a number "${n}" in "${e}"`),o!==o>>>0&&t(`Invalid number "${n}" in "${e}"`),(o<i||o>r)&&t(`The number "${n}" is out of range "[${i}, ${r}]" in "${e}"`),o}function f(n,e,i,r,o){var a=e.split("/");a.length>2&&t(`Too many slashes in "${e}"`);var s,u,h,f,c,l,m,v=a[0],D=a[1];if(v.indexOf("#")>-1)if(5===n){var M=v.split("#");v=M[0],f=[];for(var _=M.length;_-- >1;)f[_-1]=d(M[_],e,1,5)}else t(`Symbol "#" not work in "${e}"`);if(v.indexOf("W")>-1&&(3===n&&"LW"===v?(c=!0,v=v.slice(0,-1)):t(`Symbol "W" not work in "${e}"`)),"L"===v[v.length-1]&&(5===n?(u=!0,v=v.replace(/L/g,"")||"0"):3===n&&"L"===v?(u=!0,v=c?"26-31":"28-31"):t(`Symbol "L" not work in "${e}"`)),"*"===v||"?"===v)l=i,m=o;else{var g=v.split(/(?<=[*?\d])-(?=[*?\d.%-])/);g.length>2&&t(`Too many dashes in "${e}"`),(l=d(g[0],e,i,o))>(m=g[1]?d(g[1],e,i,o):D?r:l)&&t(`Incorrect range "[${l}, ${m}]" in "${e}"`)}D?(u&&3===n&&t(`Options "L" and "/${D}" are incompatible in "${e}"`),"%"===D[0]&&(h=1,D=D.slice(1)),s=d(D,e,1,o),h&&(h=s),h&&s<2&&t(`Random "%1" won't work in "${e}". Set "%2" or more`)):s=1;var p={};return u&&(p.last=u),h&&(p.rand=h),f&&(p.week=f),c&&(p.work=c),{text:e,step:s,rules:p,limit:[i,r],range:[l,m]}}function c(t){return f(0,t,0,59,59)}function l(t){return f(1,t,0,59,59)}function m(t){return f(2,t,0,23,23)}function v(t){return f(3,t,1,31,31)}function D(t){return f(4,t,1,12,12)}function M(t){return f(5,t,0,6,7)}
/*@__NO_SIDE_EFFECTS__*/function _(n){var e=a(n).split(/(?<=[*?\w])\s+(?=[*?\w.%])|(?<=[*?\w])(?=[*?])|(?<=[*?])(?=[*?\w.%])/);return e.length>6&&t(`Too many fields in ["${e.join('" "')}"]`),e.length<6&&e.unshift("0"),[h(i(e[0]).map(c),0),h(i(e[1]).map(l),1),h(i(e[2]).map(m),2),h(i(e[3]).map(v),3),h(i(s(e[4])).map(D),4),h(i(u(e[5])).map(M),5)]}var g={__proto__:null,Sun:0,Mon:1,Tue:2,Wed:3,Thu:4,Fri:5,Sat:6},p={calendar:"gregory",numberingSystem:"latn",timeZone:void 0,hourCycle:"h23",hour12:!1,weekday:"short",era:"short",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",timeZoneName:void 0,fractionalSecondDigits:void 0},S={};var Y="Incorrect ParsedDate ";function $(n,e){var i=+n;return i!==i>>>0&&t(`${Y}${e}: "${n}"`),i}function k(n){var e=n._date,i=S[n._zone].f.format(e).split(/[,\s:]+/);n.W=i[0]in g?g[i[0]]:t(`${Y}W: "${i[0]}"`),n.M=$(i[1],"M"),n.D=$(i[2],"D"),n.Y=$(i[3],"Y"),n.E="AD"===i[4]||"BC"===i[4]?i[4]:t(`${Y}E: "${i[4]}"`),n.h=$(i[5],"h"),n.m=$(i[6],"m"),n.s=$(i[7],"s"),n.t=e.getMilliseconds(),n.z=Date.UTC(n.Y,n.M-1,n.D,n.h,n.m,n.s,n.t)-e.getTime()}function T(t){var n=t.z;k(t),n!==t.z&&(t._date.setMilliseconds(n-t.z),k(t))}class ParsedDate{constructor(t,n){this._date=t?new Date(t.getTime()):new Date,this._zone=function(t){if(!S[t]){p.timeZone=t,p.timeZoneName=void 0,p.fractionalSecondDigits=void 0;var n=new Intl.DateTimeFormat("en-US",p),e=n.resolvedOptions().timeZone;S[t]=S[e]={f:n,z:e}}return S[t].z}(n),k(this)}toString(t){return p.timeZone=this._zone,p.timeZoneName="short",p.fractionalSecondDigits=3,this._date.toLocaleString(t,p)}clone(){return new ParsedDate(this._date,this._zone)}year(t){if(void 0!==t&&t!==this.Y){var n=this._date;n.setFullYear(n.getFullYear()-this.Y+t),T(this)}return this.Y}month(t){if(void 0!==t&&t!==this.M){var n=this._date;n.setMonth(n.getMonth()-this.M+t),T(this)}return this.M}date(t){if(void 0!==t&&t!==this.D){var n=this._date;n.setDate(n.getDate()-this.D+t),T(this)}return this.D}hours(t){if(void 0!==t&&t!==this.h){var n=this._date;n.setHours(n.getHours()-this.h+t),T(this)}return this.h}minutes(t){if(void 0!==t&&t!==this.m){var n=this._date;n.setMinutes(n.getMinutes()-this.m+t),T(this)}return this.m}seconds(t){if(void 0!==t&&t!==this.s){var n=this._date;n.setSeconds(n.getSeconds()-this.s+t),T(this)}return this.s}milliseconds(t){return void 0!==t&&t!==this.t&&(this._date.setMilliseconds(t),T(this)),this.t}}var w=0;function b(){++w>9e3&&t(`Max iterates count: ${w}`)}function E(t,e,i,r){var o=[],a=new ParsedDate(e,i);if(a.milliseconds(1e3),w=0,W(t,a,o),r&&o.some(function(t){return t.rand})){var s=a.clone();s.milliseconds(1e3),W(t,s,[]),function(t,e,i,r){var o,a;if(o=i[4].rand)for(a=!1,o=n(r(),0,o);o-- >0;){if(t.Y===e.Y&&t.M===e.M){a&&t.month(t.M-1);break}a=!0,t.month(t.M+1)}if(i[5].rand||i[3].rand)for(a=!1,o=n(r(),0,Math.min(i[5].rand||i[3].rand,i[3].rand||i[5].rand));o-- >0;){if(t.Y===e.Y&&t.M===e.M&&t.D===e.D){a&&t.date(t.D-1);break}a=!0,t.date(t.D+1)}if(o=i[2].rand)for(a=!1,o=n(r(),0,o);o-- >0;){if(t.Y===e.Y&&t.M===e.M&&t.D===e.D&&t.h===e.h){a&&t.hours(t.h-1);break}a=!0,t.hours(t.h+1)}if(o=i[1].rand)for(a=!1,o=n(r(),0,o);o-- >0;){if(t.Y===e.Y&&t.M===e.M&&t.D===e.D&&t.h===e.h&&t.m===e.m){a&&t.minutes(t.m-1);break}a=!0,t.minutes(t.m+1)}if(o=i[0].rand)for(a=!1,o=n(r(),0,o);o-- >0;){if(t.Y===e.Y&&t.M===e.M&&t.D===e.D&&t.h===e.h&&t.m===e.m&&t.s===e.s){a&&t.seconds(t.s-1);break}a=!0,t.seconds(t.s+1)}}(a,s,o,r)}return a._date}function W(t,n,e){var i=t[4].data;if(!(n.M in i))for(n.seconds(0),n.minutes(0),n.hours(0),n.date(1);b(),n.month(n.M+1),!(n.M in i););e[4]=i[n.M][0],L(t,n,e)}function y(t,n,e){if(n.D in t)for(var i=t[n.D],r=0;r<i.length;++r){var o=i[r];if(e[3]=o,!o.last&&!o.work)return!0;if(o.last&&o.work){if(n.W>0&&n.W<6)for(var a=n.M,s=n.clone();;){if(s.date(s.D+1),s.M!==a)return!0;if(s.W>0&&s.W<6)break}return!1}if(o.last){var u=n.M,h=n.clone();return h.date(n.D+1),h.M!==u&&(e[3]=o,!0)}if(o.work){var d=n.W;if(d>0&&d<6)return!0}}return!1}function L(t,n,e){var i=t[3].data;if(!y(i,n,e)){n.seconds(0),n.minutes(0),n.hours(0);for(var r=n.M;;){if(b(),n.date(n.D+1),n.M!==r)return W(t,n,e);if(y(i,n,e))break}}!function(t,n,e){var i=t[5].data;if(!function(t,n,e){if(n.W in t)for(var i=t[n.W],r=0;r<i.length;++r){var o=i[r];if(e[5]=o,!o.last&&!o.week)return!0;if(o.last){var a=n.M,s=n.clone();if(s.date(n.D+7),s.M!==a)return!0}if(o.week)for(var u=n.M,h=o.week,d=h.length;d-- >0;){var f=n.clone();if(f.date(n.D-7*(h[d]-1)),f.M===u&&(f.date(n.D-7*h[d]),f.M!==u))return!0}}return!1}(i,n,e)){n.seconds(0),n.minutes(0),n.hours(0),b();var r=n.M;return n.date(n.D+1),r===n.M?L(t,n,e):W(t,n,e)}N(t,n,e)}(t,n,e)}function N(t,n,e){var i=t[2].data;if(!(n.h in i)){n.seconds(0),n.minutes(0);for(var r=n.D;;){if(b(),n.hours(n.h+1),n.D!==r)return L(t,n,e);if(n.h in i)break}}e[2]=i[n.h][0],O(t,n,e)}function O(t,n,e){var i=t[1].data;if(!(n.m in i)){n.seconds(0);for(var r=n.h;;){if(b(),n.minutes(n.m+1),n.h!==r)return N(t,n,e);if(n.m in i)break}}e[1]=i[n.m][0],function(t,n,e){var i=t[0].data;if(!(n.s in i))for(var r=n.m;;){if(b(),n.seconds(n.s+1),n.m!==r)return O(t,n,e);if(n.s in i)break}e[0]=i[n.s][0]}(t,n,e)}function I(t,n){var e=n.getTime()-Date.now();t._timeoutId=e>214e7?setTimeout(function(){I(t,n)},21e8):setTimeout(function(){z(t),t.onTick.call(t)},e>=1?e:1)}function z(t){I(t,t.nextDate=E(t._cronTimeParsed,void 0,t._timeZone,t._randomFunction))}class CronScheduler{constructor(t){this._timeZone=t.timeZone,this._cronTimeParsed=_(this._cronTime=t.cronTime),this.nextDate=this._timeoutId=null,this.started=!1;var n,e=t.seedForRandom;this._randomFunction=void 0===e?Math.random:((n=e)&&isFinite(n)||(n=1),function(){var t;return t=n,t^=t<<13,(2147483648+(n=(t^=t>>17)^t<<5))/4294967296}),this.onTick=t.onTick,this.onStart=t.onStart,this.onStop=t.onStop,(t.start||void 0===t.start)&&this.start()}start(){this.started||(this.started=!0,z(this),this.onStart&&this.onStart.call(this))}stop(){this.started&&(this.started=!1,this.nextDate=null,null!=this._timeoutId&&(clearTimeout(this._timeoutId),this._timeoutId=null),this.onStop&&this.onStop.call(this))}}export{o as CRON_TIME_PRESETS,CronScheduler,ParsedDate,E as findNextExecDate,_ as parseCronTime};
